uri: https://github.com/emacs-mirror/emacs.git
branch: master
locald: repos/emacs-cui
lock: locks/emacs-cui.lock
# emacs-30.2
shell:
  - "arch"
  - "--arm64e"
  - "/bin/bash"
env:
  CFLAGS: >-
    -I/opt/homebrew/opt/llvm/lib/clang/21/include
    -I/opt/homebew/include
    -O2
    -DFD_SETSIZE=10000
    -DDARWIN_UNLIMITED_SELECT
    -I/opt/homebrew/opt/sqlite/include
    -I/opt/homebrew/opt/libgccjit/include
    -I/opt/homebrew/opt/ncurses/include
  LDFLAGS: >-
    -L/opt/homebrew/opt/llvm/lib/clang/21/lib/darwin
    -L/opt/homebrew/lib
    -L/opt/homebrew/opt/sqlite/lib
    -I/opt/homebrew/opt/libgccjit/include
    -L/opt/homebrew/opt/ncurses/lib
  CC: >-
    /opt/homebrew/opt/llvm/bin/clang
    -std=c23
  EMACSD: "$CMACSD"
setup:
  - brew install --build-from-source gcc
  - brew install --build-from-source libgccjit
  - >-
    brew install
    llvm
    ncurses
    make
    autoconf
    gnu-sed
    gnu-tar
    grep
    awk
    coreutils
    pkg-config
    texinfo
    xz
    m4
    cmigemo
    gnutls
    zlib
install:
  - ./autogen.sh
  - >-
    ./configure
    --infodir=$EMACSD/info
    --with-native-compilation=aot
    --with-gnutls
    --without-tree-sitter
    --without-compress-install
    --without-jpeg
    --without-webp
    --without-sound
    --without-pop
    --without-ns
    --without-gif
    --without-tiff
    --without-dbus
    --without-gconf
    --without-gsettings
    --without-xaw3d
    --without-gpm
    --without-libgmp
    --without-mailutils
    --without-x
    --without-x-toolkit
    --without-sqlite3
    --without-lcms2
    --without-cairo
    --without-imagemagick
    --disable-silent-rules
  - gmake V=1 -j3 bootstrap
  - gmake V=1 -j3
  - gmake V=1 -j3 install
  - /usr/local/bin/emacs --version
