uri: git://git.sv.gnu.org/emacs.git
branch: master
locald: repos/emacs-cui
lock: emacs-cui.lock
shell:
  - "arch"
  - "--arm64e"
  - "/bin/bash"
env:
  _IVG_CONCURRENCY: 2
  LDFLAGS: "-I/opt/homebrew/include -I/opt/homebrew/Cellar/libgccjit/13.1.0/include -I/opt/homebrew/Cellar/gtk+/2.24.33_1/include/gtk-2.0/gdk"
  LIBS: "-L/opt/homebrew/lib -L/opt/homebrew/Cellar/libgccjit/13.1.0/lib/gcc/current -L/opt/homebrew/Cellar/gtk+/2.24.33_1/lib"
  LIBRARY_PATH: "/opt/homebrew/lib:/opt/homebrew/Cellar/libgccjit/13.1.0/lib/gcc/current:/opt/homebrew/Cellar/gtk+/2.24.33_1/lib"
  CC: "/opt/homebrew/opt/gcc/bin/gcc-13"
setup:
  - sudo mkdir -p /usr/local/share/info /usr/local/lib/systemd/user /usr/local/include /usr/local/lib/emacs /usr/local/libexec/emacs /usr/local/share/info/dir
  - sudo chown $(whoami) /usr/local/share/info /usr/local/lib/systemd/user /usr/local/include /usr/local/lib/emacs /usr/local/libexec/emacs /usr/local/share/info/dir
  - brew install --build-from-source gcc
  - brew install --build-from-source libgccjit
  - brew install --cask xquartz
  - brew install flann cmigemo texinfo autoconf automake jpeg gtk+ zlib gnutls gtk
  - |
    if ! grep --quiet "/usr/local/opt/texinfo/bin" ~/.zprofile ; then
      echo 'export PATH=/usr/local/opt/texinfo/bin:$PATH' >> ~/.zprofile
    fi
install:
  - eval $(/opt/homebrew/bin/brew shellenv)
  - export PATH=/usr/local/opt/texinfo/bin:$PATH
  - find . -name "*.pdmp" -type f -delete
  - find . -name "*.elc" -type f -delete
  - rm -rf "${EMACSD}/eln-cache"
  - make distclean
  - ./autogen.sh
  # ignore gdk/gdkx.h by --without-x-toolkit
  - ./configure --with-native-compilation --without-xwidgets --without-webp --without-sound --without-pop --without-ns --with-gif=ifavailable --with-tiff=ifavailable --without-dbus --without-gconf --without-gsettings --without-xaw3d --without-gpm --without-mailutils --without-x --without-x-toolkit || echo "bad configure"
  - make bootstrap
  - make -j"$_IVG_CONCURRENTCY"
  - make install
  - /usr/local/bin/emacs --version
