uri: https://github.com/emacs-mirror/emacs.git
branch: master
locald: repos/emacs-cui
lock: locks/emacs-cui.lock
# emacs-30.2
shell:
  - "arch"
  - "--arm64e"
  - "/bin/bash"
env:
  MAKE_JOBS: 3
  BREW: /opt/homebrew/bin/brew
  CC: /usr/bin/clang
  MAC_CFLAGS: >-
    -O2
    -I/opt/homebrew/opt/libgccjit/include
    -I/opt/homebrew/opt/gcc/lib/gcc/current/gcc/aarch64-apple-darwin25/15/include
    -I/opt/homebrew/opt/tree-sitter@0.25/include/tree_sitter
  MAC_LIBS: >-
    -L/opt/homebrew/opt/libgccjit/lib/gcc/current
    -L/opt/homebrew/opt/tree-sitter@0.25/lib
  LIBRARY_PATH: >-
    /opt/homebrew/lib:/opt/homebrew/opt/libgccjit/lib/gcc/current:/opt/homebrew/opt/gcc/lib/gcc/current/gcc/aarch64-apple-darwin25/15:/opt/homebrew/opt/tree-sitter@0.25/lib
  PKG_CONFIG_PATH: >-
    /opt/homebrew/opt/tree-sitter@0.25/lib/pkgconfig
  EMACSD: "$CMACSD"
setup:
  - brew install --build-from-source gcc
  - brew install --build-from-source libgccjit
  - >-
    brew install
    llvm
    ncurses
    make
    autoconf
    gnu-sed
    gnu-tar
    grep
    awk
    coreutils
    pkg-config
    texinfo
    xz
    m4
    cmigemo
    gnutls
    zlib
    tree-sitter@0.25
install:
  - >-
    ls -1 |
    sort -u |
    while read -r p ; do
      echo "$p"
      rm -rf "$p"
      git checkout -- "$p" | true
    done
  - ./autogen.sh
  - >-
    ./configure
    --infodir=$EMACSD/info
    --with-native-compilation=aot
    --with-gnutls
    --with-tree-sitter
    --without-compress-install
    --without-jpeg
    --without-webp
    --without-sound
    --without-pop
    --without-ns
    --with-json
    --without-gif
    --without-tiff
    --without-dbus
    --without-gconf
    --without-gsettings
    --without-xaw3d
    --without-gpm
    --without-libgmp
    --without-mailutils
    --without-x
    --without-x-toolkit
    --without-sqlite3
    --without-lcms2
    --without-cairo
    --without-imagemagick
    --disable-silent-rules
  - gmake V=1 -j${MAKE_JOBS} bootstrap
  - gmake V=1 -j${MAKE_JOBS}
  - gmake V=1 -j${MAKE_JOBS} install
  - /usr/local/bin/emacs --version
